<div z-menu [zMenuTriggerFor]="profileMenu" zTrigger="click" zPlacement="bottomCenter">
  <button
    class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-accent/50 transition-colors duration-200 group"
  >
    <!-- Avatar -->
    <div
      class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center ring-2 ring-transparent group-hover:ring-primary/20 transition-all duration-200"
    >
      <span class="text-xs font-semibold text-primary">
        {{ profile()?.name?.charAt(0) || 'U' }}
      </span>
    </div>

    <!-- User Info (hidden on mobile) -->
    <div class="hidden md:block text-left">
      <p class="text-sm font-medium text-foreground leading-none">
        {{ profile()?.name || 'User' }}
      </p>
      <p class="text-xs text-muted-foreground mt-0.5">
        {{ profile()?.email || 'user@example.com' }}
      </p>
    </div>

    <!-- Chevron -->
    <hia-icon
      name="lucideChevronDown"
      [size]="14"
      class="text-muted-foreground group-hover:text-foreground transition-all duration-200"
    />
  </button>
</div>

<!-- Menu Content Template -->
<ng-template #profileMenu>
  <div z-menu-content class="w-64 p-2">
    <!-- Profile Header -->
    <div class="px-3 py-2 border-b border-border mb-2">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
          <span class="text-sm font-semibold text-primary">
            {{ profile()?.name?.charAt(0) || 'U' }}
          </span>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-medium text-foreground truncate">
            {{ profile()?.name || 'User' }}
          </p>
          <p class="text-xs text-muted-foreground truncate">
            {{ profile()?.email || 'user@example.com' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Menu Items -->
    <div class="space-y-1">
      <!-- House Switcher (mobile only) -->
      <div class="sm:hidden mb-2">
        <button
          type="button"
          (click)="onSwitchHouse()"
          class="w-full flex items-center gap-3 px-3 py-2 text-sm text-foreground hover:bg-accent rounded-md transition-colors"
        >
          <hia-icon name="lucideHouse" [size]="16" class="text-muted-foreground" />
          Switch House
        </button>
      </div>

      @for (item of menuItems(); track $index) {
      <z-button
        type="button"
        zType="text"
        [label]="item.label"
        [iconName]="item.icon"
        [iconSize]="16"
        [routerLink]="item.to"
        class="w-full flex items-start justify-start hover:bg-accent rounded-md transition-colors"
      />
      }
      <div class="h-px bg-border my-2"></div>
      <z-button
        type="button"
        zType="text"
        label="Sign Out"
        iconName="lucideLogOut"
        [iconSize]="16"
        (click)="onLogout()"
        class="w-full flex items-start justify-start text-destructive hover:bg-destructive/10 hover:text-destructive rounded-md transition-colors"
      />
    </div>
  </div>
</ng-template>
