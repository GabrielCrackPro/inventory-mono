<div class="max-w-4xl mx-auto p-6 space-y-6">
  @if (!canCreateItem()) {
  <z-alert
    zTitle="Insufficient permissions"
    zDescription="You do not have permission to create items."
    zType="warning"
    zAppearance="outline"
  ></z-alert>
  }
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <div class="flex items-center gap-3">
        <z-button [iconName]="commonIcons['back']" zType="text" (click)="goBack()" />
        <h1 class="text-2xl font-bold text-foreground">{{ pageTitle() }}</h1>
      </div>
      <p class="text-muted-foreground">{{ pageSubtitle() }}</p>
    </div>
    <div class="flex items-center gap-4">
      <!-- Progress Bar -->
      <div class="flex items-center gap-2">
        <div class="text-sm text-muted-foreground">Progress:</div>
        <div class="w-32 h-3 bg-muted rounded-full overflow-hidden relative">
          <div
            class="h-full bg-linear-to-r from-primary to-primary/80 transition-all duration-500 ease-out rounded-full"
            [style.width.%]="formProgress()"
          ></div>
        </div>
        <span class="text-sm font-medium transition-all duration-300"> {{ formProgress() }}% </span>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="flex items-center justify-center py-12">
    <div class="text-center">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
      <p class="text-muted-foreground">Loading item data...</p>
    </div>
  </div>
  } @else {
  <!-- Form -->
  <form [formGroup]="itemForm" (ngSubmit)="onSubmit()">
    <z-tab-group class="min-h-[600px]" (zOnTabChange)="onTabChange($event)">
      <!-- General Information Tab -->
      <z-tab [label]="getTabLabel('General Info', 'general')">
        <hia-add-general-tab [itemForm]="itemForm" />
      </z-tab>

      <!-- Storage & Location Tab -->
      <z-tab [label]="getTabLabel('Storage & Location', 'storage')">
        <hia-add-storage-tab [itemForm]="itemForm" />
      </z-tab>

      <!-- Purchase Information Tab -->
      <z-tab [label]="getTabLabel('Purchase Info', 'purchase')">
        <hia-add-purchase-tab [itemForm]="itemForm" />
      </z-tab>

      <!-- Additional Details Tab -->
      <z-tab [label]="getTabLabel('Additional Details', 'details')">
        <hia-add-details-tab [itemForm]="itemForm" />
      </z-tab>

      <!-- Sharing & Access Tab -->
      <z-tab [label]="getTabLabel('Sharing & Access', 'sharing')">
        <hia-add-sharing-tab [itemForm]="itemForm" />
      </z-tab>
    </z-tab-group>

    <!-- Form Actions -->
    <div class="flex items-center justify-between pt-6 border-t border-border">
      <div class="text-sm">
        @if (itemForm.invalid && itemForm.touched) { @if (!completionSummary().isMinimumComplete) {
        <span class="text-destructive"
          >Please complete required fields in General Info and Storage tabs</span
        >
        } @else {
        <span class="text-amber-600">Some fields have validation errors</span>
        } } @else if (completionSummary().isMinimumComplete) {
        <span class="text-green-600">âœ“ Ready to save - all required fields completed</span>
        } @else {
        <span class="text-muted-foreground">Fill in the required fields to enable saving</span>
        }
      </div>

      <div class="flex gap-3">
        <z-button zType="outline" label="Cancel" (click)="onCancel()" [disabled]="isSubmitting()" />
        <z-button
          [label]="submitButtonText()"
          [iconName]="isEditMode() ? commonIcons['edit'] : commonIcons['add']"
          type="submit"
          [zLoading]="isSubmitting()"
          [disabled]="!canCreateItem() || !completionSummary().isMinimumComplete || isSubmitting()"
        />
      </div>
    </div>
  </form>
  }
</div>
