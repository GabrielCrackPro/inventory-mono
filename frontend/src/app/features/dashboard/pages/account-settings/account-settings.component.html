<div class="max-w-4xl mx-auto p-6 space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <div class="flex items-center gap-3">
        <z-button [iconName]="commonIcons['back']" zType="text" (click)="goBack()" />
        <h1 class="text-2xl font-bold text-foreground">Account Settings</h1>
      </div>
      <p class="text-muted-foreground">Manage your account information and security</p>
    </div>
  </div>

  <!-- Profile Picture Card -->
  <z-card zTitle="Profile Picture" zDescription="Upload or change your profile picture">
    <div class="flex items-center gap-6">
      <!-- Avatar Display -->
      <div class="relative">
        @if (profilePicturePreview()) {
        <img
          [src]="profilePicturePreview()"
          alt="Profile picture"
          class="w-24 h-24 rounded-full object-cover ring-2 ring-border"
        />
        } @else {
        <div
          class="w-24 h-24 rounded-full bg-primary/20 flex items-center justify-center ring-2 ring-border"
        >
          <span class="text-2xl font-semibold text-primary">
            {{ getInitials(profileForm.get('name')?.value || 'U') }}
          </span>
        </div>
        } @if (isUploadingPicture()) {
        <div
          class="absolute inset-0 bg-background/80 rounded-full flex items-center justify-center"
        >
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        </div>
        }
      </div>

      <!-- Upload Controls -->
      <div class="flex-1 space-y-3">
        <div class="flex gap-3">
          <label class="cursor-pointer">
            <input
              type="file"
              accept="image/*"
              class="hidden"
              (change)="onFileSelected($event)"
              [disabled]="isUploadingPicture()"
            />
            <z-button
              type="button"
              label="Upload Photo"
              iconName="lucideUpload"
              [disabled]="isUploadingPicture()"
              class="pointer-events-none"
            />
          </label>
          @if (profilePicturePreview()) {
          <z-button
            type="button"
            zType="destructive"
            label="Remove"
            iconName="lucideTrash2"
            (click)="removeProfilePicture()"
            [disabled]="isUploadingPicture()"
          />
          }
        </div>
        <p class="text-sm text-muted-foreground">
          JPG, PNG or GIF. Max size 5MB. Recommended size 400x400px.
        </p>
      </div>
    </div>
  </z-card>

  <!-- Profile Information Card -->
  <z-card zTitle="Profile Information" zDescription="Update your personal information">
    <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()" class="space-y-4">
      <!-- Name Field -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-foreground">Name</label>
        <input
          z-input
          type="text"
          formControlName="name"
          placeholder="Enter your name"
          class="w-full px-3 py-2 rounded-md border bg-transparent"
          [class.border-destructive]="getFieldError('profile', 'name')"
        />
        @if (getFieldError('profile', 'name')) {
        <p class="text-sm text-destructive">{{ getFieldError('profile', 'name') }}</p>
        }
      </div>

      <!-- Email Field -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-foreground">Email</label>
        <input
          z-input
          type="email"
          formControlName="email"
          placeholder="Enter your email"
          class="w-full px-3 py-2 rounded-md border bg-transparent"
          [class.border-destructive]="getFieldError('profile', 'email')"
        />
        @if (getFieldError('profile', 'email')) {
        <p class="text-sm text-destructive">{{ getFieldError('profile', 'email') }}</p>
        }
      </div>

      <!-- Submit Button -->
      <div class="flex justify-end pt-4">
        <z-button
          type="submit"
          label="Save Changes"
          [iconName]="commonIcons['save']"
          [zLoading]="isSubmitting()"
          [disabled]="profileForm.invalid || profileForm.pristine || isSubmitting()"
        />
      </div>
    </form>
  </z-card>

  <!-- Password Change Card -->
  <z-card zTitle="Change Password" zDescription="Update your password to keep your account secure">
    <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="space-y-4">
      <!-- Current Password Field -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-foreground">Current Password</label>
        <div class="relative">
          <input
            z-input
            [type]="showCurrentPassword() ? 'text' : 'password'"
            formControlName="currentPassword"
            placeholder="Enter your current password"
            class="w-full px-3 py-2 pr-10 rounded-md border bg-transparent"
            [class.border-destructive]="getFieldError('password', 'currentPassword')"
          />
          <button
            type="button"
            (click)="togglePasswordVisibility('current')"
            class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
          >
            <hia-icon [name]="showCurrentPassword() ? 'lucideEyeOff' : 'lucideEye'" [size]="18" />
          </button>
        </div>
        @if (getFieldError('password', 'currentPassword')) {
        <p class="text-sm text-destructive">{{ getFieldError('password', 'currentPassword') }}</p>
        }
      </div>

      <!-- New Password Field -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-foreground">New Password</label>
        <div class="relative">
          <input
            z-input
            [type]="showNewPassword() ? 'text' : 'password'"
            formControlName="newPassword"
            placeholder="Enter your new password"
            class="w-full px-3 py-2 pr-10 rounded-md border bg-transparent"
            [class.border-destructive]="getFieldError('password', 'newPassword')"
          />
          <button
            type="button"
            (click)="togglePasswordVisibility('new')"
            class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
          >
            <hia-icon [name]="showNewPassword() ? 'lucideEyeOff' : 'lucideEye'" [size]="18" />
          </button>
        </div>
        @if (getFieldError('password', 'newPassword')) {
        <p class="text-sm text-destructive">{{ getFieldError('password', 'newPassword') }}</p>
        }
      </div>

      <!-- Confirm Password Field -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-foreground">Confirm New Password</label>
        <div class="relative">
          <input
            z-input
            [type]="showConfirmPassword() ? 'text' : 'password'"
            formControlName="confirmPassword"
            placeholder="Confirm your new password"
            class="w-full px-3 py-2 pr-10 rounded-md border bg-transparent"
            [class.border-destructive]="getFieldError('password', 'confirmPassword')"
          />
          <button
            type="button"
            (click)="togglePasswordVisibility('confirm')"
            class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
          >
            <hia-icon [name]="showConfirmPassword() ? 'lucideEyeOff' : 'lucideEye'" [size]="18" />
          </button>
        </div>
        @if (getFieldError('password', 'confirmPassword')) {
        <p class="text-sm text-destructive">{{ getFieldError('password', 'confirmPassword') }}</p>
        }
      </div>

      <!-- Password Requirements -->
      <div class="bg-muted/50 rounded-md p-3 text-sm text-muted-foreground">
        <p class="font-medium mb-1">Password requirements:</p>
        <ul class="list-disc list-inside space-y-1">
          <li>At least 6 characters long</li>
          <li>Must match the confirmation password</li>
        </ul>
      </div>

      <!-- Submit Button -->
      <div class="flex justify-end pt-4">
        <z-button
          type="submit"
          label="Change Password"
          iconName="lucideKey"
          [zLoading]="isChangingPassword()"
          [disabled]="passwordForm.invalid || isChangingPassword()"
        />
      </div>
    </form>
  </z-card>
</div>
