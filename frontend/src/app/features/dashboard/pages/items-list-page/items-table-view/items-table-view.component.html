<div class="overflow-auto h-full">
  <table z-table class="table-fixed text-sm">
    <thead z-table-header>
      <tr z-table-row>
        @for (col of columns(); track col?.key) { @if (col && (col.visible ?? true)) {
        <th
          z-table-head
          class="whitespace-nowrap text-xs"
          [class.cursor-pointer]="col.sortable && col.key !== 'select'"
          (click)="col.key !== 'select' && onColSort(col.key)"
        >
          @if (col.key === 'select') {
          <z-checkbox
            class="h-4 w-4"
            [checkedInput]="items().length > 0 && selectedIds().length === items().length"
            [indeterminate]="selectedIds().length > 0 && selectedIds().length < items().length"
            (click)="$event.stopPropagation()"
            (checkChange)="toggleSelectAll.emit($event)"
          />
          } @else {
          <span class="inline-flex items-center gap-1">
            {{ col.header }}
            @if (col.sortable && sortKey() === col.key) {
            <hia-icon [name]="sortDir() === 'asc' ? 'ChevronUp' : 'ChevronDown'" [size]="10" />
            }
          </span>
          }
        </th>
        } }
      </tr>
    </thead>
    <tbody z-table-body>
      @for (item of items(); track item.id) {
      <tr
        z-table-row
        class="cursor-pointer hover:bg-accent/20"
        [routerLink]="hasSelectColumn() ? undefined : ['/dashboard/items/detail', item.id]"
      >
        @for (col of columns(); track col?.key) { @if (col && (col.visible ?? true)) {
        <td
          z-table-cell
          [class]="(col.key === 'select' ? '' : 'truncate ') + (col.cellClass || '')"
        >
          @if (col.key === 'select') {
          <z-checkbox
            class="h-4 w-4"
            [checkedInput]="selectedIds().includes(item.id)"
            (click)="$event.stopPropagation()"
            (checkChange)="toggleSelect.emit({ id: item.id, selected: $event })"
          />
          } @else { @switch (col.format) { @case ('currency') {
          {{ getRaw(item, col) ?? 0 | currency }} } @case ('date') { @if (getRaw(item, col)) {
          {{ getRaw(item, col) | date : 'MMM d, y' }} } @else { - } } @case ('datetime') { @if
          (getRaw(item, col)) { {{ getRaw(item, col) | date : 'MMM d, y, HH:mm' }} } @else { - } }
          @default { {{ getRaw(item, col) || '-' }} } } }
        </td>
        } }
      </tr>
      }
    </tbody>
  </table>
</div>
