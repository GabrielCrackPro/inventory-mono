<div class="min-h-screen bg-background">
  <!-- Header Section -->
  <div class="border-b border-border/40 bg-card/30">
    <div class="max-w-5xl mx-auto px-4 py-5">
      @if (!canCreateItem()) {
      <z-alert
        zTitle="Insufficient permissions"
        zDescription="You do not have permission to create items."
        zType="warning"
        zAppearance="outline"
        class="mb-4"
      ></z-alert>
      }

      <div class="flex items-start justify-between gap-4">
        <div class="flex items-start gap-3 flex-1 min-w-0">
          <z-button
            [iconName]="commonIcons['back']"
            zType="ghost"
            zSize="icon"
            (click)="goBack()"
            class="shrink-0 mt-1"
          />
          <div class="flex-1 min-w-0">
            <h1 class="text-2xl font-bold text-foreground">{{ pageTitle() }}</h1>
            <p class="text-sm text-muted-foreground mt-1">{{ pageSubtitle() }}</p>
          </div>
        </div>

        <!-- Progress Indicator -->
        <div class="flex items-center gap-3 shrink-0">
          <div class="text-right">
            <div class="text-xs text-muted-foreground uppercase tracking-wide">Progress</div>
            <div class="text-lg font-bold text-foreground">{{ formProgress() }}%</div>
          </div>
          <div class="w-24 h-2 bg-muted rounded-full overflow-hidden">
            <div
              class="h-full bg-primary transition-all duration-500 ease-out rounded-full"
              [style.width.%]="formProgress()"
            ></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Section -->
  <div class="max-w-5xl mx-auto px-4 py-6">
    <!-- Loading State -->
    @if (isLoading()) {
    <div class="flex items-center justify-center py-16">
      <div class="text-center">
        <div
          class="animate-spin rounded-full h-10 w-10 border-2 border-primary border-t-transparent mx-auto mb-4"
        ></div>
        <p class="text-sm text-muted-foreground">Loading item data...</p>
      </div>
    </div>
    } @else {
    <!-- Form -->
    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Tabs -->
      <z-tab-group class="min-h-[500px]" (zOnTabChange)="onTabChange($event)">
        <!-- General Information Tab -->
        <z-tab [label]="getTabLabel('General Info', 'general')">
          <div class="py-4">
            <hia-add-general-tab [itemForm]="itemForm" />
          </div>
        </z-tab>

        <!-- Storage & Location Tab -->
        <z-tab [label]="getTabLabel('Storage & Location', 'storage')">
          <div class="py-4">
            <hia-add-storage-tab [itemForm]="itemForm" />
          </div>
        </z-tab>

        <!-- Purchase Information Tab -->
        <z-tab [label]="getTabLabel('Purchase Info', 'purchase')">
          <div class="py-4">
            <hia-add-purchase-tab [itemForm]="itemForm" />
          </div>
        </z-tab>

        <!-- Additional Details Tab -->
        <z-tab [label]="getTabLabel('Additional Details', 'details')">
          <div class="py-4">
            <hia-add-details-tab [itemForm]="itemForm" />
          </div>
        </z-tab>

        <!-- Sharing & Access Tab -->
        <z-tab [label]="getTabLabel('Sharing & Access', 'sharing')">
          <div class="py-4">
            <hia-add-sharing-tab [itemForm]="itemForm" />
          </div>
        </z-tab>
      </z-tab-group>

      <!-- Form Actions -->
      <div
        class="sticky bottom-0 bg-background/95 backdrop-blur-sm border-t border-border/60 -mx-4 px-4 py-4 shadow-lg"
      >
        <div class="max-w-5xl mx-auto flex items-center justify-between gap-4">
          <!-- Status Message -->
          <div class="flex items-center gap-2 text-sm">
            @if (itemForm.invalid && itemForm.touched) { @if
            (!completionSummary().isMinimumComplete) {
            <div class="flex items-center gap-2 text-destructive">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10" />
                <line x1="12" x2="12" y1="8" y2="12" />
                <line x1="12" x2="12.01" y1="16" y2="16" />
              </svg>
              <span>Please complete required fields in General Info and Storage tabs</span>
            </div>
            } @else {
            <div class="flex items-center gap-2 text-amber-600 dark:text-amber-400">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"
                />
                <line x1="12" x2="12" y1="9" y2="13" />
                <line x1="12" x2="12.01" y1="17" y2="17" />
              </svg>
              <span>Some fields have validation errors</span>
            </div>
            } } @else if (completionSummary().isMinimumComplete) {
            <div class="flex items-center gap-2 text-emerald-600 dark:text-emerald-400">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
              </svg>
              <span>Ready to save - all required fields completed</span>
            </div>
            } @else {
            <div class="flex items-center gap-2 text-muted-foreground">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10" />
                <path d="M12 16v-4" />
                <path d="M12 8h.01" />
              </svg>
              <span>Fill in the required fields to enable saving</span>
            </div>
            }
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-2 shrink-0">
            <z-button
              zType="outline"
              label="Cancel"
              (click)="onCancel()"
              [disabled]="isSubmitting()"
            />
            <z-button
              [label]="submitButtonText()"
              [iconName]="isEditMode() ? commonIcons['edit'] : commonIcons['add']"
              type="submit"
              [zLoading]="isSubmitting()"
              [disabled]="
                !canCreateItem() || !completionSummary().isMinimumComplete || isSubmitting()
              "
            />
          </div>
        </div>
      </div>
    </form>
    }
  </div>
</div>
